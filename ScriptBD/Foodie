CREATE DATABASE Foodi;
USE Foodi;

CREATE TABLE Pago
(
  Id_Pago INT IDENTITY(1,1),
  Nombre VARCHAR(50) NOT NULL,
  Activo INT NULL DEFAULT 1,
  CONSTRAINT PK_id_pago PRIMARY KEY (Id_Pago)
);

CREATE TABLE Mesa
(
  Id_Mesa INT IDENTITY(1,1),
  Cap_Personas_Max INT NOT NULL,
  Ocupado INT NULL,
  CONSTRAINT PK_id_mesa PRIMARY KEY (Id_Mesa)
);

CREATE TABLE Menu
(
  Id_Menu INT IDENTITY(1,1),
  Nombre VARCHAR(50) NOT NULL,
  Activo INT NULL DEFAULT 1,
  CONSTRAINT PK_id_menu PRIMARY KEY (Id_Menu)
);

CREATE TABLE Rol
(
  Id_Rol INT IDENTITY(1,1),
  Nombre VARCHAR(50) NOT NULL,
  Activo INT NULL DEFAULT 1,
  CONSTRAINT PK_id_rol PRIMARY KEY (Id_Rol)
);

CREATE TABLE Producto
(
  Id_Producto INT IDENTITY(1,1),
  Nombre VARCHAR(50) NOT NULL,
  Descripción VARCHAR(100) NULL,
  Precio FLOAT NOT NULL,
  Activo INT NOT NULL DEFAULT 1,
  Stock INT NOT NULL,
  Stock_minimo INT NOT NULL,
  Id_Menu INT NOT NULL,
  CONSTRAINT PK_id_producto PRIMARY KEY (Id_Producto),
  CONSTRAINT FK_id_menu FOREIGN KEY (Id_Menu) REFERENCES Menu(Id_Menu)
);

CREATE TABLE Usuario
(
  Id_Usuario INT IDENTITY(1,1),
  DNI INT NOT NULL,
  Nombre VARCHAR(50) NOT NULL,
  Apellido VARCHAR(50) NOT NULL,
  Fecha_Incorporación DATE NOT NULL,
  Contraseña VARCHAR(150) NOT NULL,
  Activo INT NOT NULL DEFAULT 1,
  Id_Rol INT NOT NULL,
  CONSTRAINT PK_id_usuario PRIMARY KEY (Id_Usuario),
  CONSTRAINT FK_id_rol FOREIGN KEY (Id_Rol) REFERENCES Rol(Id_Rol)
);

CREATE TABLE Pedido
(
  Id_Pedido INT IDENTITY(1,1),
  Total FlOAT NOT NULL,
  Fecha DATE NOT NULL,
  Id_Pago INT NOT NULL,
  Id_Usuario INT NOT NULL,
  Nro_factura VARCHAR(200) NOT NULL,
  Id_Mesa INT NOT NULL,
  CONSTRAINT PK_id_pedido PRIMARY KEY (Id_Pedido),
  CONSTRAINT FK_id_pago FOREIGN KEY (Id_Pago) REFERENCES Pago(Id_Pago),
  CONSTRAINT FK_id_usuario FOREIGN KEY (Id_Usuario) REFERENCES Usuario(Id_Usuario),
  CONSTRAINT FK_id_mesa FOREIGN KEY (Id_Mesa) REFERENCES Mesa(Id_Mesa),
); 

CREATE TABLE Pedido_Detalle
(
  Id_Pedido_Detalle INT IDENTITY(1,1),
  Cantidad INT NOT NULL,
  Subtotal FLOAT NOT NULL,
  Id_Pedido INT NOT NULL,
  Id_Producto INT NOT NULL,
  Precio FLOAT NOT NULL,
  CONSTRAINT PK_id_pedido_detalle PRIMARY KEY (Id_Pedido_Detalle),
  CONSTRAINT FK_id_pedido FOREIGN KEY (Id_Pedido) REFERENCES Pedido(Id_Pedido),
  CONSTRAINT FK_id_producto FOREIGN KEY (Id_Producto) REFERENCES Producto(Id_Producto),
);
